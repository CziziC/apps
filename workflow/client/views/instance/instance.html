<template name="instanceform">
    <div class="instanceContent">
        <div class="row" style="border-bottom:1px solid #3c8dbc;">
            <div class="container">
                <span class="help-block"></span>
                <div class="col-sm-6" style="padding:0px;">
                    <div class="button-group">
                        <button type="button" class="btn btn-primary" id="instance_submit" style={{enabled_submit}}>提交</button>
                        <span class="btn glyphicon glyphicon-save" id="instance_update" title="保存" style={{enabled_save}}></span>
                        <span class="btn glyphicon glyphicon-remove" id="instance_remove" title="删除" style={{enabled_delete}}></span>
                        <span class="btn glyphicon glyphicon-print" id="instance_to_print" title="打印" style={{enabled_print}}></span>
                        <div class="ins-upload" id="instance_add_attachment" style={{enabled_add_attachment}}>
                          <span class="btn glyphicon glyphicon-paperclip ins-file-icon"  title="附件"></span>
                          <input type="file" name="file" class="ins-file-input">
                        </div>
                        <span class="btn glyphicon glyphicon-ban-circle" id="instance_force_end" data-toggle="modal" data-target="#force_end_modal" title="取消申请" style={{enabled_terminate}}></span>
                        {{> force_end_modal}}
                        <span class="btn glyphicon glyphicon-user" id="instance_reassign" data-toggle="modal" data-target="#reassign_modal" title="转签核" style={{enabled_reassign}}></span>
                        {{> reassign_modal}}
                        <span class="btn glyphicon glyphicon-random" id="instance_relocate" data-toggle="modal" data-target="#relocate_modal" title="重定位" style={{enabled_relocate}}></span>
                        {{> relocate_modal}}
                        <div style='display:none'><input id="instanceId" value="{{instance._id}}"/></div>
                    </div>
                </div>
            </div>
        </div>
        {{#if show_suggestion}}
        <nav class="navbar navbar-default navbar-static-top" role="navigation">
            <div class="container">
                <span class="help-block"></span>
                {{#if includes currentStep.step_type 'sign,counterSign'}}
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <label>{{currentStep.name}}&nbsp;:&nbsp;&nbsp;</label>
                            <label class="radio-inline">
                                {{#if equals currentApprove.judge 'approved'}}
                                    <input type='radio' name='judge' value="approved" class='suggestion' checked/>核准
                                {{else}}
                                    <input type='radio' name='judge' value="approved" class='suggestion'/>核准
                                {{/if}}
                            </label>
                            <label class="radio-inline">
                                {{#if equals currentApprove.judge 'rejected'}}
                                <input type='radio' name='judge' value="rejected" class='suggestion' checked/>驳回
                                {{else}}
                                <input type='radio' name='judge' value="rejected" class='suggestion' />驳回
                                {{/if}}
                            </label>
                        </div>
                    </div>
                </div>
                {{/if}}
                <div class="row">
                    <div class="col-sm-12">
                        <div class="form-group">
                            <textarea name="" class="suggestion-control" id="suggestion">{{currentApprove.description}}</textarea>
                            <span class="help-block"></span>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-3">
                        <div class="form-group">
                            <label class="control-label">下一步骤&nbsp;:</label>
                            <select class="suggestion-control" name="nextSteps" id="nextSteps">
                            </select>
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="col-sm-3">
                        <div class="form-group" id="nextStepUsers_div">
                            <label class="control-label">处理人&nbsp;:</label>
                            <select class="suggestion-control" name="nextStepUsers" id="nextStepUsers">
                            </select>
                            <span class="help-block"></span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        {{else}}
            <span class="help-block"></span>
        {{/if}}
        <div class="container">
            <nav class="navbar navbar-default navbar-static-top" role="navigation">
                <div class="container">
                    <div class="navbar-header">
                       <h3 class='font-size-h3'>{{instance.name}}</h3>
                    </div>
                </div>
            </nav>
            {{#autoForm id=instanceId schema=fields type=form_types doc=doc_values meteormethod='instance'}}
                <div class="row">
                    {{#each steedos_form.fields}}
                        {{#if equals this.type 'table'}}
                            <div class="{{#if this.is_wide}}col-md-12{{else}}col-md-16{{/if}}">
                            
                            {{> Template.dynamic template="autoform_table" data=(innersubformContext this)}}
                            </div>
                        {{else}}
                            {{#if equals this.type 'section'}}
                                <div class="col-md-12">
                                    <div class='panel panel-info section'>
                                        <div class="panel-heading">{{this.code}}</div>
                                    </div>
                                </div>
                            {{else}}
                                <div class="{{#if this.is_wide}}col-md-12{{else}}col-md-6{{/if}}">
                                {{> afFormGroup name=this.code}}
                                </div>
                            {{/if}}
                        {{/if}}
                        
                    {{/each}}
                </div>
                
            {{/autoForm}}
             <div style='display:none'>{{init_nextStepsOptions}}{{init_formScripts}}</div>
             <div class="row">
                <div class="col-md-12">
                    {{> Template.dynamic template="instance_attachments" data=instance.attachments}}
                    <!-- {{> instance_attachments}} -->
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    {{> Template.dynamic template="instance_traces" data=instance.traces}}
                </div>
            </div>
        </div>
    </div>
</template>


